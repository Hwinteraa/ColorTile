<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>puzzle</title>
    <link rel="stylesheet" href="../style.css">
    <style></style>

    <script src="easel.js"></script>
    <script type="text/javascript">
        var canvas;
        var stage;
        //var squareSide = 70;
        //var squareOutline = 5;
        //var max_rgb_color_value = 255;
        //var gray = Graphics.getRGB(20, 20, 20);
        var placementArray = [];
        //var highlight = Graphics.getRGB(255, 255, 0);
        var tileClicked;
        var timeAllowable;
        var totalMatchesPossible;
        var matchesFound;
        var txt;
        var matchesFoundText;

        var tileHeight = 30;
        var tileWidth = 45;
        var border = 1;
        var globalPadding = 10;
        var margin = 10;
        var padding = 5;
        var textTiles;
        var flashcards =
            [
                ["a", "\u3042"], ["i", "\u3044"], ["u", "\u3046"], ["e", "\u3048"], ["o", "\u304A"], ["ka", "\u304B"], ["ki", "\u304D"], ["ku", "\u304F"], ["ke", "\u3051"], ["ko", "\u3053"], ["sa", "\u3055"], ["shi", "\u3057"], ["su", "\u3059"], ["se", "\u305B"], ["so", "\u305D"], ["ta", "\u305F"], ["chi", "\u3061"], ["tsu", "\u3064"], ["te", "\u3066"], ["to", "\u3068"], ["na", "\u306A"], ["ni", "\u306B"], ["nu", "\u306C"], ["ne", "\u306D"], ["no", "\u306E"], ["ha", "\u306F"], ["hi", "\u3072"], ["fu", "\u3075"], ["he", "\u3078"], ["ho", "\u307B"], ["ma", "\u307E"], ["mi", "\u307F"], ["mu", "\u3080"], ["me", "\u3081"], ["mo", "\u3082"], ["ya", "\u3084"], ["yu", "\u3086"], ["yo", "\u3088"], ["ra", "\u3089"], ["ri", "\u308A"], ["ru", "\u308B"], ["re", "\u308C"], ["ro", "\u308D"], ["wa", "\u308F"], ["wo", "\u3092"], ["n", "\u3093"]
            ];
        //var squares;

        function init() {
            //var rows = 5;
            //var columns = 6;
            //var squarePadding = 10;

            canvas = document.getElementById('myCanvas');
            stage = new Stage(canvas);
            //var square = drawSquare();
            //stage.addChild(square);
            //stage.update();
            totalMatchesPossible = flashcards.length;
            var numberOfTiles = totalMatchesPossible * 2;

            //var numberOfTiles = rows * columns;
            matchesFound = 0;

            var columns = 12;
            timeAllowable = 500;

            //timeAllowable = 100;
            txt = new Text(timeAllowable, "30px Monospace", "#000");
            txt.textBaseline = "top";
            //txt.x = 500;
            txt.x = 700;
            txt.y = 0;
            stage.addChild(txt);

            textTiles = [];
            matchesFoundText = new Text(matchesFound + "/" + totalMatchesPossible, "30px Monospace", "#000");

            //squares = [];
            //totalMatchesPossible = numberOfTiles / 2;
            //matchesFoundText = new Text("Pairs Found:" + matchesFound + "/" + totalMatchesPossible, "30px Monospace", "#000");
            matchesFoundText.textBaseline = "top";
            matchesFoundText.x = 700;
            //matchesFoundText.x = 500;
            matchesFoundText.y = 40;
            stage.addChild(matchesFoundText);
            Ticker.init();
            Ticker.addListener(window);
            Ticker.setPaused(false);
            setPlacementArray(numberOfTiles);

            for (var i = 0; i < numberOfTiles; i++) {
                var placement = getRandomPlacement(placementArray);

                var pairIndex = Math.floor(i / 2);
                text = flashcards[pairIndex][i % 2];
                var textTile = drawTextTile(text, pairIndex);
                textTile.x = (tileWidth + margin) * (placement % columns) + globalPadding;
                textTile.y = (tileHeight + margin) * Math.floor(placement / columns) + globalPadding;
                stage.addChild(textTile);
                background = new Shape();
                background.x = textTile.x - padding;
                background.y = textTile.y - padding;
                background.graphics.setStrokeStyle(border).beginStroke("#000").beginFill('#eee').drawRect(0, 0, tileWidth, tileHeight);
                textTiles.push(background);
                stage.addChildAt(background);
                background.text = textTile;
                background.onPress = handleOnPress;

                //if (i % 2 === 0) {
                //    var color = randomColor();
                //}
                ////var square = drawSquare(color);
                //var square = drawSquare(gray);
                //square.color = color;
                //square.x = (squareSide + squarePadding) * (placement % columns);
                //square.y = (squareSide + squarePadding) * Math.floor(placement / columns);
                //squares.push(square);
                //stage.addChild(square);
                //square.onPress = handleOnPress;
                stage.update();
            };
        }

        function drawSquare(color) {
            var shape = new Shape();
            var graphics = shape.graphics;
            //  var color = randomColor();
            graphics.setStrokeStyle(squareOutline);
            graphics.beginStroke(gray);
            graphics.beginFill(color);
            graphics.rect(squareOutline, squareOutline, squareSide, squareSide);
            return shape;
        }

        function randomColor() {
            var color = Math.floor(Math.random() * max_rgb_color_value);
            var color2 = Math.floor(Math.random() * max_rgb_color_value);
            var color3 = Math.floor(Math.random() * max_rgb_color_value);
            return Graphics.getRGB(color, color2, color3)
        }

        function setPlacementArray(numberOfTiles) {
            for (var i = 0; i < numberOfTiles; i++) {
                placementArray.push(i);
            }
        }

        function getRandomPlacement(placementArray) {
            randomNumber = Math.floor(Math.random() * placementArray.length);
            return placementArray.splice(randomNumber, 1)[0];
        }

        function handleOnPress(event) {
            var tile = event.target;
            //tile.graphics.beginFill(tile.color).rect(squareOutline, squareOutline, squareSide, squareSide);
            if (!!tileClicked === false || tileClicked === tile) {
                tileClicked = tile;
            }
            else {
                tileClicked.graphics.beginFill('#eee').drawRect(0, 0, tileWidth, tileHeight);
                tile.graphics.beginFill('#aae').drawRect(0, 0, tileWidth, tileHeight);
                if (tileClicked.text.pairIndex === tile.text.pairIndex && tileClicked.id != tile.id)
                //if (tileClicked.color === tile.color && tileClicked !== tile)
                {
                    tileClicked.visible = false;
                    tile.visible = false;

                    matchesFound++;
                    //matchesFoundText.text = "Pairs Found: " + matchesFound + "/" + totalMatchesPossible;
                    matchesFoundText.text = matchesFound + "/" + totalMatchesPossible;
                    if (matchesFound === totalMatchesPossible) {
                        gameOver(true);
                    }
                }
                //else
                //{
                //    tileClicked.graphics.beginFill(gray)
                //        .rect(squareOutline, squareOutline, squareSide, squareSide);
                //}
                tileClicked = tile;
            }
            stage.update();
        }

        function drawTextTile(text, pairIndex) {
            textTile = new Text(text, "20px Monospace", "#000");
            textTile.pairIndex = pairIndex;
            textTile.textBaseline = "top";
            return textTile;
        }

        function tick() {
            secondsLeft = Math.floor((timeAllowable - Ticker.getTime() / 1000));
            txt.text = secondsLeft;
            if (secondsLeft <= 0) {
                gameOver(false);
            }
            stage.update();
        }

        function gameOver(win) {
            Ticker.setPaused(true);
            //for (var i = 0; i < squares.length; i++)
            //{
            //    squares[i].graphics.beginFill(squares[i].color).rect(5, 5, 70, 70);
            //    squares[i].onPress = null;
            //}
            var replayParagraph = document.getElementById("replay");
            replayParagraph.innerHTML = "<a href='#' onclick='replay();'>Play Again?</a>";

            for (var i = 0; i < textTiles.length; i++) {
                textTiles[i].onPress = null;
            }

            if (win === true) {
                matchesFoundText.text = "You win!"
            }
            else {
                txt.text = secondsLeft + "... Game Over";
            }
        }

        function replay() {
            var replayParagraph = document.getElementById(" ");
            replayParagraph.innerHTML =
                init();
        }
    </script>
</head>

<body onload="init()">
    <!-- header -->
    <header>
        <div class="container">
            <h1>
                <button onclick="window.location.href='../index.html';">GC</button>
            </h1>
        </div>
    </header>
    <!-- //end header -->

    <!-- PortFolio -->
    <section id="portfolio" class="portfolio">
        <div class="container">
            <div class="title">
                <h4>2022100290</h4>
                <h2>puzzle</h2>
            </div>
            <div class="portfolio-me">
                <div class="portfolio-inner">
                    <!--<img src="mock1.png">-->

                    <header id="header" class="EaselJS">
                        <p id="replay"></p>
                    </header>
                    <canvas id="myCanvas" width="960" height="400"></canvas>

                </div>
            </div>
        </div>
    </section>
    <!-- //end PortFolio -->


</body>

</html>
